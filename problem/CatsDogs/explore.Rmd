---
title: 'Cats versus Dogs'
output: html_notebook
---

```{r, message = FALSE}
library(tidyverse)
```

```{r}
data <- read.csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018-09-11/cats_vs_dogs.csv') %>%
  select(state, 
         n_households,
         n_pet_households,
         n_cat_households, cat_population,
         n_dog_households, dog_population) %>%
  rename(State = state,
         TotalHouseholds = n_households,
         PetHouseholds = n_pet_households,
         CatHouseholds = n_cat_households,
         DogHouseholds = n_dog_households,
         CatPets = cat_population,
         DogPets = dog_population) %>%
  gather(Key, Value, -State, -TotalHouseholds, -PetHouseholds) %>%
  extract(Key, c('Pet', 'Key'), '(Cat|Dog)(Households|Pets)') %>%
  spread(Key, Value) %>%
  select(State, Pet, Households, Pets, PetHouseholds, TotalHouseholds) %>%
  mutate(Pet = fct_rev(Pet))
```

## Which states like cats the most?

```{r}
data1 <- data %>%
  group_by(State) %>%
  mutate(CatDogPets = sum(Pets),
         CatPetLead = sum((Pet == 'Cat') * Pets) > sum((Pet == 'Dog') * Pets),
         CatHouseholdLead = sum((Pet == 'Cat') * Households) > sum((Pet == 'Dog') * Households)) %>%
  ungroup() %>%
  mutate(PetFraction = Pets / CatDogPets,
         HouseholdFraction = Households / PetHouseholds)
```

### By Households

```{r, dev = 'svg', fig.height = 3.5, fig.width = 10}
data1 %>%
  filter(CatHouseholdLead) %>%
  mutate(State = fct_reorder(State, (Pet == 'Cat') * HouseholdFraction)) %>%
  ggplot(aes(State, HouseholdFraction, fill = Pet)) +
  geom_col() +
  labs(y = 'Fraction') +
  theme(legend.title = element_blank(),
        axis.title.y = element_blank()) +
  coord_flip()
```

### By Cat and Dog Pets

```{r, dev = 'svg', fig.height = 10, fig.width = 10}
data1 %>%
  filter(CatPetLead) %>%
  mutate(State = fct_reorder(State, (Pet == 'Cat') * PetFraction)) %>%
  ggplot(aes(State, PetFraction, fill = Pet)) +
  geom_col() +
  labs(y = 'Fraction') +
  theme(legend.title = element_blank(),
        axis.title.y = element_blank()) +
  coord_flip()
```
